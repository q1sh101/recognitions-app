// =============================================================================
// _runtime-bridge.scss
// Purpose: Runtime theming via CSS variables (Bootstrap 5.3+ optimized).
// Strategy: Leverage Bootstrap's built-in color mode + custom design tokens.
// Author: Giorgi Kishmaria (@q1sh101)
// =============================================================================

/* 
   ARCHITECTURE DECISION:
   - Bootstrap 5.3+ has native data-bs-theme="dark" support
   - We use data-theme="dark" (custom) for JS toggle
   - This file bridges data-theme → Bootstrap semantics
   - Generic approach: override design tokens, not individual classes
*/

/* ============================================================================
   LIGHT MODE (DEFAULT)
   Custom design tokens + Bootstrap variable overrides
   ========================================================================== */

:root {
  /* Custom design tokens */
  --app-gray-900:        #{$color-gray-900};
  --app-gray-800:        #{$color-gray-800};
  --app-gray-700:        #{$color-gray-700};
  --app-gray-600:        #{$color-gray-600};
  --app-gray-500:        #{$color-gray-500};
  --app-gray-400:        #{$color-gray-400};
  --app-gray-300:        #{$color-gray-300};
  --app-gray-200:        #{$color-gray-200};
  --app-gray-100:        #{$color-gray-100};

  --app-primary:         #{$color-brand-primary};
  --app-success:         #{$color-success};
  --app-danger:          #{$color-danger};
  --app-warning:         #{$color-brand-accent};
  --app-info:            #{$color-info};

  /* Bootstrap core overrides (light mode) */
  --bs-body-bg:          #ffffff;
  --bs-body-color:       var(--app-gray-900);
  --bs-border-color:     var(--app-gray-200);

  --bs-secondary:        var(--app-gray-600);
  --bs-secondary-rgb:    #{to-rgb($color-gray-600)};

  --bs-light:            var(--app-gray-100);
  --bs-light-rgb:        #{to-rgb($color-gray-100)};

  --bs-dark:             var(--app-gray-900);
  --bs-dark-rgb:         #{to-rgb($color-gray-900)};

  /* Bootstrap semantic colors (light mode) */
  --bs-secondary-color:  #{rgba($color-gray-700, 0.75)};
  --bs-secondary-bg:     var(--app-gray-100);
  --bs-tertiary-color:   #{rgba($color-gray-700, 0.5)};
  --bs-tertiary-bg:      var(--app-gray-100);

  /* Shadows (light mode) */
  --bs-box-shadow:       #{$shadow-sm};
  --bs-box-shadow-sm:    #{$shadow-xs};
  --bs-box-shadow-lg:    #{$shadow-lg};
}

/* ============================================================================
   DARK MODE (data-theme="dark")
   Override Bootstrap design tokens globally
   ========================================================================== */

:root[data-theme="dark"] {
  /* Body & backgrounds */
  --bs-body-bg:          var(--app-gray-900);
  --bs-body-color:       var(--app-gray-100);
  --bs-border-color:     var(--app-gray-700);

  /* Invert light/dark semantics */
  --bs-secondary:        var(--app-gray-300);
  --bs-secondary-rgb:    #{to-rgb($color-gray-700)};

  --bs-light:            var(--app-gray-800);
  --bs-light-rgb:        #{to-rgb($color-gray-800)};

  --bs-dark:             var(--app-gray-100);
  --bs-dark-rgb:         #{to-rgb($color-gray-100)};

  /* Bootstrap semantic colors (dark mode) */
  --bs-secondary-color:  #{rgba($color-gray-300, 0.7)};
  --bs-secondary-bg:     var(--app-gray-800);
  --bs-tertiary-color:   #{rgba($color-gray-400, 0.5)};
  --bs-tertiary-bg:      var(--app-gray-800);
  --bs-emphasis-color:   var(--app-gray-100);

  /* Shadows (dark mode — subtle) */
  --bs-box-shadow:       0 0.125rem 0.25rem rgba(0, 0, 0, 0.5);
  --bs-box-shadow-sm:    0 0.0625rem 0.125rem rgba(0, 0, 0, 0.4);
  --bs-box-shadow-lg:    0 0.5rem 1rem rgba(0, 0, 0, 0.6);

  /* Links */
  --bs-link-color:       var(--app-primary);
  --bs-link-hover-color: #{tint-color($color-brand-primary, 14%)};

  /* -------------------------------------------------------------------------
     NAVBAR (global — affects ALL .navbar-light, .navbar-dark)
     ------------------------------------------------------------------------- */
  --bs-navbar-color:              #{rgba($color-gray-100, 0.85)};
  --bs-navbar-hover-color:        var(--app-gray-100);
  --bs-navbar-active-color:       var(--app-gray-100);
  --bs-navbar-brand-color:        var(--app-gray-100);
  --bs-navbar-brand-hover-color:  var(--app-gray-100);

  /* -------------------------------------------------------------------------
     BUTTONS (global — affects ALL button variants)
     ------------------------------------------------------------------------- */
  
  /* Outline buttons (generic) */
  .btn-outline-secondary {
    --bs-btn-color:             var(--app-gray-300);
    --bs-btn-border-color:      var(--app-gray-600);
    --bs-btn-hover-color:       var(--app-gray-100);
    --bs-btn-hover-bg:          #{rgba($color-gray-700, 0.3)};
    --bs-btn-hover-border-color: var(--app-gray-500);
    --bs-btn-active-color:      var(--app-gray-100);
    --bs-btn-active-bg:         #{rgba($color-gray-700, 0.5)};
    --bs-btn-active-border-color: var(--app-gray-500);
  }
  
  /* -------------------------------------------------------------------------
   CARDS & CONTAINERS
   ------------------------------------------------------------------------- */
  .card {
    --bs-card-bg: var(--app-gray-800);
    --bs-card-border-color: var(--app-gray-900);
  }

  /* -------------------------------------------------------------------------
     FORMS (inputs, selects, textareas)
     ------------------------------------------------------------------------- */
  --bs-form-control-bg:        var(--app-gray-800);
  --bs-form-control-color:     var(--app-gray-100);
  --bs-form-control-border-color: var(--app-gray-700);

  /* -------------------------------------------------------------------------
     TOASTS
     ------------------------------------------------------------------------- */
  --bs-toast-bg:               #2b2f36;
  --bs-toast-border-color:     #3a404a;
  --bs-toast-color:            #e7ebf1;
}

/* ============================================================================
   AUTO DARK MODE (OS preference, no explicit data-theme)
   ========================================================================== */

@media (prefers-color-scheme: dark) {
  :root:not([data-theme]) {
    --bs-body-bg:          var(--app-gray-900);
    --bs-body-color:       var(--app-gray-100);
    --bs-border-color:     var(--app-gray-700);

    --bs-secondary:        var(--app-gray-300);
    --bs-secondary-rgb:    #{to-rgb($color-gray-600)};

    --bs-light:            var(--app-gray-800);
    --bs-light-rgb:        #{to-rgb($color-gray-800)};

    --bs-dark:             var(--app-gray-100);
    --bs-dark-rgb:         #{to-rgb($color-gray-100)};

    --bs-secondary-color:  #{rgba($color-gray-300, 0.7)};
    --bs-secondary-bg:     var(--app-gray-800);
    --bs-tertiary-color:   #{rgba($color-gray-400, 0.5)};
    --bs-tertiary-bg:      var(--app-gray-800);
    --bs-emphasis-color:   var(--app-gray-100);

    --bs-box-shadow:       0 0.125rem 0.25rem rgba(0, 0, 0, 0.5);
    --bs-box-shadow-sm:    0 0.0625rem 0.125rem rgba(0, 0, 0, 0.4);
    --bs-box-shadow-lg:    0 0.5rem 1rem rgba(0, 0, 0, 0.6);

    --bs-navbar-color:              #{rgba($color-gray-100, 0.85)};
    --bs-navbar-hover-color:        var(--app-gray-100);
    --bs-navbar-active-color:       var(--app-gray-100);
    --bs-navbar-brand-color:        var(--app-gray-100);
    --bs-navbar-brand-hover-color:  var(--app-gray-100);

    .btn-outline-secondary {
      --bs-btn-color:             var(--app-gray-300);
      --bs-btn-border-color:      var(--app-gray-600);
      --bs-btn-hover-color:       var(--app-gray-100);
      --bs-btn-hover-bg:          #{rgba($color-gray-700, 0.3)};
      --bs-btn-hover-border-color: var(--app-gray-500);
    }
    .card {
      --bs-card-bg:           var(--app-gray-800);
      --bs-card-border-color: var(--app-gray-900);
    }
  }
}

/* ============================================================================
   ACCESSIBILITY
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
  :root {
    --bs-transition-duration: 0.01ms;
    --bs-transition: none;
  }
}

@media (prefers-contrast: more) {
  :root {
    --bs-focus-ring-width:    0.375rem;
    --bs-focus-ring-opacity:  0.35;
  }
}

/* ============================================================================
   THEME SWITCHER ICONS (simple, bulletproof)
   ========================================================================== */

[data-theme-visibility] {
  display: none;
}

:root[data-theme="dark"] [data-theme-visibility="dark"] {
  display: block;
}

:root[data-theme="light"] [data-theme-visibility="light"],
:root:not([data-theme]) [data-theme-visibility="light"] {
  display: block;
}

/* ============================================================================
   USAGE:
   
   JavaScript (theme_controller.js):
   document.documentElement.setAttribute('data-theme', 'dark');
   document.documentElement.setAttribute('data-theme', 'light');
   document.documentElement.removeAttribute('data-theme'); // auto mode
   ========================================================================== */
